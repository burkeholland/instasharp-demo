(function(){define(["jquery","kendo","mylibs/common/comments","text!mylibs/common/feed/views/item-template.html"],function(n,t,i,r){return function(){function n(n){var u=this;this.url=n,this.maxId=null,this.viewModel=t.observable({items:new t.data.DataSource,ds:new t.data.DataSource({transport:{read:{url:function(){return u.url+(u.maxId!==null?"?next_max_id="+u.maxId:"")}}},schema:{parse:function(n){return u.maxId=n.pagination.next_max_id,$.each(n.data,function(n,t){return t.has_comments=t.comments.count>!0?!0:!1}),n},data:"data"},change:function(n){var t,i;return i=u.viewModel.get("items"),t=i.view(),$.merge(t,n.sender.view()),i.data(t)},requestEnd:function(){return u.viewModel.set("loading",!1)}}),more:function(){return u.viewModel.set("loading",!0),u.viewModel.get("ds").read()},loading:!0,loaded:function(n){return t.fx($(n.target).parent()).fade("in").play()},like:function(n){var o,r,i,e,f,t;return t=$(n.target),f=t.prev(),e=t.next(),t.hide(),f.show(),r=t.data("id"),o=u.viewModel.get("items"),i=o.get(r),t.hasClass("selected")?$.post("api/media/"+r+"/like/delete",function(){return i.likes.count--,e.html(i.likes.count),f.hide(),t.show().removeClass("selected")}):$.post("api/media/"+r+"/like",function(){return i.likes.count++,e.html(i.likes.count),f.hide(),t.show().addClass("selected")})},comment:function(n){var t,u,r,f,e;return t=$(n.target).prev(),r=t.data("id"),e=t.val(),u=this.get("items"),f=u.get(r),i.post(r,e).then(function(){return f.comments.push({profile_picture:APP.user.profile_picture,username:APP.user.username})})}}),$("#feed-template").length===0&&$(document.body).append(r)}return n}()})}).call(this)