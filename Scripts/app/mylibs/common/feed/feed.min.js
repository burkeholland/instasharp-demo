(function(){define(["jquery","kendo","text!mylibs/common/feed/views/item-template.html"],function(n,t,i){return function(){function n(n){var r=this;this.url=n,this.maxId=null,this.viewModel=t.observable({items:new t.data.DataSource,ds:new t.data.DataSource({transport:{read:{url:function(){return r.url+(r.maxId!==null?"?next_max_id="+r.maxId:"")}}},schema:{parse:function(n){return r.maxId=n.pagination.next_max_id,$.each(n.data,function(n,t){return t.has_comments=t.comments.count>!0?!0:!1}),n},data:"data"},change:function(n){var t,i;return i=r.viewModel.get("items"),t=i.view(),$.merge(t,n.sender.view()),i.data(t)},requestEnd:function(){return r.viewModel.set("loading",!1)}}),more:function(){return r.viewModel.set("loading",!0),r.viewModel.get("ds").read()},loading:!0,loaded:function(n){return t.fx($(n.target).parent()).fade("in").play()},like:function(n){var o,u,i,e,f,t;return t=$(n.target),f=t.prev(),e=t.next(),t.hide(),f.show(),u=t.data("id"),o=r.viewModel.get("items"),i=o.get(u),t.hasClass("selected")?$.post("api/media/"+u+"/like/delete",function(){return i.likes.count--,e.html(i.likes.count),f.hide(),t.show().removeClass("selected")}):$.post("api/media/"+u+"/like",function(){return i.likes.count++,e.html(i.likes.count),f.hide(),t.show().addClass("selected")})},comment:function(n){var t,r,i,u,f,e=this;return t=$(n.target).closest("input"),i=t.data("id"),f=t.val(),r=this.get("ds"),u=r.get(i),u.comments.add,$.post("api/media/"+i+"/comment",function(){})}}),$("#feed-template").length===0&&$(document.body).append(i)}return n}()})}).call(this)